class Event{get type(){return this._type}get owner(){return this._owner}get data(){return this._data}get listeners(){return this._listeners}constructor(type,owner,data){this.isEvent=true;this._type=type;this._owner=owner;this._data=data;this._listeners=[]}add(listener){if(!this._listeners.includes(listener))this._listeners.push(listener)}removes(listener){this._listeners=this._listeners.filter((l=>l!=listener))}trigger(source,data={}){for(let listener of this._listeners){let captured=listener(this,source,data);if(captured)break}}}class Type{static get record(){return this._record}get name(){return this._name}get instances(){return this._instances}get parent(){return this._parent}get children(){return this._children}constructor(name,innerType,parent){this._name=name;if(!Type._record[name])Type._record[name]=this;if(parent){this._parent=parent;this._parent.children.push(this)}this._children=[]}is(type){let t=this;while(t){if(t==type)return true;t=t._parent}return false}register(instance){let type=instance.type;while(type){type._instances.push(instance);type=type._parent}}}Type._record={};class Item{get type(){return this._type}get name(){return this._name}get parent(){return this._parent}get children(){return this._children}get links(){return this._links}get updated(){return this._updated}set updated(value){if(this._updated==value)return;this._updated=value;this._updateTime=Date.now();this._onModified.trigger(this,value);Item.onModified.trigger(this,value);if(value==false){if(this._parent)this._parent.updated=false;for(let link of this._links)link.updated=false}}get updateTime(){return this._updateTime}get onModified(){return this._onModified}get onPreUpdate(){return this._onPreUpdate}get onPostUpdate(){return this._onPostUpdate}static get onModified(){return Item._onModified}static get onPreUpdate(){return Item._onPreUpdate}static get onPostUpdate(){return Item._onPostUpdate}constructor(name,parent,data){let type=this.constructor["type"],className=this.constructor.name;if(type&&type instanceof Type)this._type=type;else throw Error("No type data defined for class '"+className+"'. Remember to add it through the 'type' static property.");if(name&&typeof name=="string"&&name.length>0)this._name=name;else this._name=type.name;if(parent&&parent instanceof Item){this._parent=parent;parent._children.add(this)}this._children=new Collection([Item.type],this);this._links=new Collection([Item.type],this);this._onModified=new Event("modified",this);this._onPreUpdate=new Event("pre-update",this);this._onPostUpdate=new Event("post-update",this);if(data!=undefined)this.deserialize(data);this.updated=false;this._updateTime=Date.now();Item.onCreation.trigger(this)}update(deltaTime=0,forced=false){if(this._updated&&!forced)return;this._onPreUpdate.trigger(this);Item._onPreUpdate.trigger(this);for(let child of this._children)child.update(deltaTime,forced);this._updated=true;this._onPostUpdate.trigger(this);Item._onPostUpdate.trigger(this)}destroy(){if(this._parent)this._parent._children.remove(this);if(this._children.count>0)this._children.clear()}serialize(format){return Serialization.serialize(this,format)}deserialize(data={}){Serialization.deserialize(this,data)}toString(){return JSON.stringify(this.deserialize())}}Item.type=new Type("item",Item);Item._onModified=new Event("modified");Item._onPreUpdate=new Event("pre-update");Item._onPostUpdate=new Event("post-update");Item.onCreation=new Event("creation");class Collection{get count(){return this._count}get owner(){return this._owner}constructor(types,owner){this._types=types;this._owner=owner;this._items=[];this._count=0}getByIndex(index){if(index>=0&&index<this._items.length)return this._items[index];return undefined}getByName(name){for(let item of this._items)if(item.name==name)return item;return undefined}add(item,position){if(position==undefined)this._items.push(item);else{let index=0,size=this._items.length;if(position>0){index=position;if(index>size)index=size}else{index=size-position;if(index<0)index=0}this._items.splice(index,0,item)}this._count++}remove(item){for(let itemIndex=0;itemIndex<this._count;itemIndex++){if(this._items[itemIndex]==item){this._items.splice(itemIndex,1);itemIndex--;this._count--}}}clear(){while(this._count>0){this._items[0].destroy();this._items.splice(0,1);this._count--}}[Symbol.iterator](){let pointer=0,items=this._items;return{next(){if(pointer<items.length)return{done:false,value:items[pointer++]};else return{done:true,value:null}}}}}class Serialization{static serialize(item,format){let data={};for(let child of item.children)data[child.name]=child.serialize(format);return data}static deserialize(item,data){if(typeof data=="string"){let parsed;try{parsed=Serialization.fromCSV(data)}catch{}if(!parsed)try{parsed=Serialization.fromCSV(data)}catch{}if(!parsed)try{parsed=Serialization.fromJSON(data)}catch{}if(!parsed)return;data=parsed}if(Array.isArray(data)){for(let[index,dataPart]of data){if(index>=item.children.count)return;item.children[index].deserialize(dataPart)}}else for(let key in data){let dataPart=data[key];if(dataPart==undefined)continue;let child=item.children.getByName(key);if(child)child.deserialize(dataPart)}}static fromWords(s,separator=" "){let data=[];return data}static fromCSV(s){let data=[];return data}static fromJSON(s){return JSON.parse(s)}static toCSV(data){let string="";return string}static toJSON(data,maxIndentation=0){let string="";return string}static toString(item){let s="";return s}}var SerializationFormat;(function(SerializationFormat){SerializationFormat[SerializationFormat["CSV"]=0]="CSV";SerializationFormat[SerializationFormat["JSON"]=1]="JSON";SerializationFormat[SerializationFormat["XML"]=2]="XML"})(SerializationFormat||(SerializationFormat={}));class Simple extends Item{get value(){if(this._value==undefined)return this._defaultValue;return this._value}set value(newValue){if(this._value==newValue)return;if(!this.checkValue(newValue))throw Error('Invalid value "'+newValue+'" for: '+this.name);this._value=newValue;this.updated=false}get defaultValue(){return this._defaultValue}set defaultValue(newDefaultValue){if(this._defaultValue==newDefaultValue)return;if(!this.checkValue(newDefaultValue))throw Error('Invalid default value "'+newDefaultValue+'" for: '+this._name);this._defaultValue=newDefaultValue;this.updated=false}get validValues(){return this._validValues}set validValues(newValidValues){this._validValues=newValidValues;if(!this.checkValue(this._value))throw Error('Invalid value "'+this._value+'" for: '+this._name)}get validValueIndex(){if(this.validValues!=undefined&&this.value!=undefined)return this.validValues.indexOf(this.value);return undefined}get isDefault(){return this._value==this._defaultValue}get isUndefined(){return this._value==undefined}get onModified(){return this._onModified}constructor(name,parent,data){super(name,parent,data);this._validValues=undefined;if(data!=undefined)this.deserialize(data)}valueOf(){return this.value}checkValue(value){if(value==undefined)return true;if(this._validValues&&!this._validValues.includes(value))return false;return true}}Simple.type=new Type("simple",Simple,Item.type);class Boolean extends Simple{constructor(name,parent,data){super(name,parent,data);this._value=undefined;this._defaultValue=false;if(data!=undefined)this.deserialize(data)}serialize(){return this.value}deserialize(data){if(typeof data=="object"){this._defaultValue=data.defaultValue;data=this.value=data.value}else if(typeof data!=="boolean")this.value=data=="false"||data==0?false:true;else this.value=data}toString(){return this.value?"true":"false"}valueOf(){return this.value}}Boolean.type=new Type("boolean",Boolean,Simple.type);class Number extends Simple{get min(){return this._min}set min(newMin){if(newMin==undefined){this._min=newMin;return}if(this._max!=undefined&&newMin>this._max)this._max=newMin;if(this._value!=undefined&&this._value<newMin)this._value=newMin;this._min=newMin;this.updated=false}get max(){return this._max}set max(newMax){if(newMax==undefined){this._max=newMax;return}if(this._min!=undefined&&newMax<this._min)this._min=newMax;if(this._value!=undefined&&this._value>newMax)this._value=newMax;this._max=newMax;this.updated=false}constructor(name,parent,data){super(name,parent,data);this._value=undefined;this._defaultValue=0;if(data!=undefined)this.deserialize(data)}serialize(){return this.value}deserialize(data){if(typeof data=="object"){this.min=data.min;this.max=data.max;this.defaultValue=data.defaultValue;data=this.value=data.value}else if(typeof data!=="number")this.value=parseFloat(data);else this.value=data}checkValue(value){if(this._min!=undefined&&value<this._min)return false;if(this._max!=undefined&&value>this._max)return false;return super.checkValue(value)}toString(){return this.value.toFixed(2)||""}}Number.type=new Type("number",Number,Simple.type);class String extends Simple{get validRegEx(){return this._validRegEx}set validRegEx(newValidRegEx){this._validRegEx=newValidRegEx;if(!this._value)return;if(!this.checkValue(this._value))throw Error('Invalid value "'+this._value+'" for: '+this.name);this._onModified.trigger(this)}constructor(name,parent,data){super(name,parent,data);if(data!=undefined)this.deserialize(data)}serialize(){return this.value}deserialize(data){if(typeof data=="object"){this._validValues=data.validValues;this._validRegEx=data.validRegEx;this._defaultValue=data.defaultValue;data=this.value=data.value}else if(typeof data!=="string")data=JSON.stringify(data);else this.value=data}checkValue(value){if(this._validRegEx&&!this._validRegEx.test(value))return false;return super.checkValue(value)}toString(){return this.value||""}}String.type=new Type("string",String,Simple.type);class Measure extends Number{get unit(){return this._units[this._unitIndex]}get units(){return this._units}get unitIndex(){return this._unitIndex}set unitIndex(u){this._unitIndex=u;this._onModified.trigger(this)}constructor(name,parent,data){super(name,parent,data);let units=this.constructor["units"],className=this.constructor.name;if(units)this._units=units;else throw Error("No units defined for class '"+className+"'.");this._unitIndex=0;if(data!=undefined)this.deserialize(data)}}Measure.type=new Type("measure",Measure,Number.type);class MeasurementUnit{get id(){return this._id}get abbrevs(){return this._abbrevs}get factor(){return this._factor}get default(){return this._default}get min(){return this._min}get max(){return this._max}constructor(id,abbrevs,factor=1,defaultValue,min,max){this._id=id;this._abbrevs=abbrevs;this._factor=factor;this._default=defaultValue;this._min=min;this._max=max}}class Angle extends Measure{constructor(name,parent,data){super(name,parent,data);if(data!=undefined)this.deserialize(data)}}Angle.type=new Type("angle",Angle,Measure.type);Angle.units=[new MeasurementUnit("degrees",["deg","d","º"],1),new MeasurementUnit("radians",["rad","RAD"],Math.PI/180)];class Distance extends Measure{constructor(name,parent,data){super(name,parent,data);if(data!=undefined)this.deserialize(data)}}Distance.type=new Type("distance",Distance,Measure.type);Distance.units=[new MeasurementUnit("meters",["m","ms"],1),new MeasurementUnit("centimeters",["cm","cms"],.01),new MeasurementUnit("millimeters",["mm","mms"],.001),new MeasurementUnit("kilometers",["km","kms"],1e3)];class Size extends Measure{constructor(name,parent,data){super(name,parent,data);this._value=0;this._min=0;if(data!=undefined)this.deserialize(data)}}Size.type=new Type("size",Size,Measure.type);Size.units=[new MeasurementUnit("meters",["m","ms"],1),new MeasurementUnit("centimeters",["cm","cms"],.01),new MeasurementUnit("millimeters",["mm","mms"],.001),new MeasurementUnit("kilometers",["km","kms"],1e3)];class Time extends Measure{constructor(name,parent,data){super(name,parent,data);if(data!=undefined)this.deserialize(data)}}Time.type=new Type("Time",Time,Measure.type);Time.units=[new MeasurementUnit("seconds",["s","sec"],1),new MeasurementUnit("minutes",["m","mins"],1/60),new MeasurementUnit("hours",["h"],1/3600),new MeasurementUnit("milliseconds",["ms","millisecs"],1e3)];class Complex extends Item{get isDefault(){for(let component of this._components)if(!component.isDefault)return false;return true}get isUndefined(){for(let component of this._components)if(!component.isUndefined)return false;return true}constructor(name,parent,data){super(name,parent,data);if(data!=undefined)this.deserialize(data)}}Complex.type=new Type("complex",Complex,Item.type);class Vector extends Complex{get x(){return this._x}get y(){return this._y}get z(){return this._z}get length(){let x=this._x.value,y=this._y.value,z=this._z.value;return new Size(this.name+"length",undefined,{value:Math.sqrt(x*x+y*y+z*z)})}set length(size){if(typeof size!="number")size=size.value;let x=this._x.value,y=this._y.value,z=this._z.value;let length=Math.sqrt(x*x+y*y+z*z),factor=size/length;this._x.value=x*factor;this._y.value=y*factor;this._z.value=z*factor}constructor(name,parent,data){super(name,parent,data);this._x=new Distance("x",this);this._y=new Distance("y",this);this._z=new Distance("z",this);this._components=[this._x,this._y,this._z];if(data!=undefined)this.deserialize(data)}getValues(){return{x:this._x.value,y:this._y.value,z:this._z.value}}setValues(x=0,y=0,z=0){this._x.value=x;this._y.value=y;this._z.value=z}normalize(){this.length=1}toString(){return this._components.join(", ")}}Vector.type=new Type("vector",Vector,Complex.type);class Color extends Complex{get r(){return this._r}get g(){return this._g}get b(){return this._b}get a(){return this._a}constructor(name,parent,data){super(name,parent,data);this._r=new Number("r",this,{min:0,max:1,defaultValue:0});this._g=new Number("g",this,{min:0,max:1,defaultValue:0});this._b=new Number("b",this,{min:0,max:1,defaultValue:0});this._a=new Number("a",this,{min:0,max:1,defaultValue:1});this._components=[this._r,this._g,this._b,this._a];if(data!=undefined)this.deserialize(data)}getValues(){return{r:this._r.value,g:this._g.value,b:this._b.value,a:this._a.value}}setValues(r=0,g=0,b=0,a=1){this._r.value=r;this._g.value=g;this._b.value=b;this._a.value=a}toString(){return"rgb("+this._r+", "+this._g+", "+this._b+")"}}Color.type=new Type("color",Color,Complex.type);class Euler extends Complex{get x(){return this._x}get y(){return this._y}get z(){return this._z}get order(){return this._order}constructor(name,parent,data){super(name,parent,data);this._x=new Angle("x",this,0);this._y=new Angle("y",this,0);this._z=new Angle("z",this,0);this._order=new String("order",this,"XYZ");this._components=[this._x,this._y,this._z];if(data!=undefined)this.deserialize(data)}getValues(){return{x:this._x.value,y:this._y.value,z:this._z.value}}setValues(x=0,y=0,z=0){this._x.value=x;this._y.value=y;this._z.value=z}}Euler.type=new Type("euler",Euler,Complex.type);class Quaternion extends Complex{get x(){return this._x}get y(){return this._y}get z(){return this._z}get w(){return this._w}constructor(name,parent,data){super(name,parent,data);this._x=new Number("x",this,0);this._y=new Number("y",this,0);this._z=new Number("z",this,0);this._w=new Number("w",this,1);this._components=[this._x,this._y,this._z,this._w];if(data)this.deserialize(data)}getValues(){return{x:this._x.value,y:this._y.value,z:this._z.value,w:this._w.value}}setValues(x=0,y=0,z=0,w=1){this._x.value=x;this._y.value=y;this._y.value=z;this._w.value=w}}Quaternion.type=new Type("quaternion",Quaternion,Complex.type);class Shape extends Item{get shaded(){return this._shaded}get color(){return this._color}get texture(){return this._texture}get emissive(){return this._emissive}constructor(name,parent,data){super(name,parent,data);this._shaded=new String("shaded",this);this._color=new String("color",this);this._texture=new String("texture",this);this._emissive=new String("color",this);if(data!=undefined)this.deserialize(data)}}Shape.type=new Type("shape",Shape,Item.type);class Box extends Shape{get width(){return this._width}get height(){return this._height}get depth(){return this._depth}constructor(name,parent,data){super(name,parent,data);this._width=new Size("width",this);this._depth=new Size("depth",this);this._height=new Size("height",this);if(data!=undefined)this.deserialize(data)}}Box.type=new Type("box",Box,Shape.type);class Ellipsoid extends Shape{get radiusX(){return this._radiusX}get radiusY(){return this._radiusY}get radiusZ(){return this._radiusZ}constructor(name,parent,data){super(name,parent,data);this._radiusX=new Size("radiusX",this);this._radiusY=new Size("radiusY",this);this._radiusZ=new Size("radiusZ",this);if(data!=undefined)this.deserialize(data)}}Ellipsoid.type=new Type("ellipsoid",Ellipsoid,Shape.type);class Sphere extends Shape{get radius(){return this._radius}constructor(name,parent,data){super(name,parent,data);this._radius=new Size("radius",this);if(data!=undefined)this.deserialize(data)}}Sphere.type=new Type("sphere",Sphere,Shape.type);class Frame extends Item{get handedness(){return this._handedness}get verticalAxis(){return this._verticalAxis}constructor(name,parent,data){super(name,parent,data);this._handedness=new String("handedness",this,{validValues:["right","left"],defaultValue:"right"});this._verticalAxis=new String("verticalAxis",this,{validValues:["X","Y","Z"],defaultValue:"Z"});if(data!=undefined)this.deserialize(data)}}Frame.type=new Type("frame",Frame,Item.type);class EuclideanFrame extends Frame{}class GeoFrame extends Frame{get equatorialRadius(){return this._equatorialRadius}get polarRadius(){return this._polarRadius}constructor(name,parent,data={}){super(name,parent,data);this._equatorialRadius=new Distance("equatorialRadius",this,data.equatorialRadius||6378137);this._polarRadius=new Distance("polarRadius",this,data.equatorialRadius||6356752.314245);if(data!=undefined)this.deserialize(data)}}GeoFrame.type=new Type("geo-frame",GeoFrame,Frame.type);GeoFrame.defaultFrame=new GeoFrame("Earth",undefined);class Position extends Item{get relativeValues(){return this._relativeValues}get absoluteValues(){return this._absoluteValues}get additionalRotation(){return this._additionalRotation}constructor(name,parent,data){super(name,parent,data);this._relativeValues=new Vector("relativeValues",this);this._absoluteValues=new Vector("absoluteValues",this);this._additionalRotation=new Vector("additionalRotation",this);if(data!=undefined)this.deserialize(data)}}Position.type=new Type("position",Position,Item.type);class EuclideanPosition extends Position{get x(){return this._x}get y(){return this._y}get z(){return this._z}constructor(name,parent,data){super(name,parent,data);this._x=new Distance("x",this);this._y=new Distance("y",this);this._z=new Distance("z",this);if(data!=undefined)this.deserialize(data)}}EuclideanPosition.type=new Type("euclidean-position",EuclideanPosition,Position.type);class GeoPosition extends Position{get longitude(){return this._longitude}get latitude(){return this._latitude}get altitude(){return this._altitude}get tangentVector(){return this._tangentVector}get verticalVector(){return this._verticalVector}constructor(name,parent,data){super(name,parent,data);this._longitude=new Angle("longitude",this);this._latitude=new Angle("latitude",this);this._altitude=new Distance("h",this);this._tangentVector=new Vector("tangentVector",this);this._verticalVector=new Vector("verticalVector",this);if(data!=undefined)this.deserialize(data)}update(deltaTime=0,forced=false){if(this._updated&&!forced)return;let geoFrame=this.parent.frame,equatorRadius=geoFrame.equatorialRadius.value,polarRadius=geoFrame.polarRadius.value,flatteningFactor=polarRadius/equatorRadius;let lng=-this.longitude.value*(Math.PI/180),lat=this.latitude.value*(Math.PI/180),lngSin=Math.sin(lng),lngCos=Math.cos(lng),latSin=Math.sin(lat),latCos=Math.cos(lat),alt=this.altitude.value,geoX=lngCos*latCos,geoY=latSin,geoZ=lngSin*latCos;let x=geoX*equatorRadius,y=geoY*equatorRadius*flatteningFactor,z=geoZ*equatorRadius;this._verticalVector.setValues(geoX,geoY/flatteningFactor,geoZ);this._verticalVector.normalize();let v=this._verticalVector.getValues();this.relativeValues.setValues(x+v.x*alt,y+v.y*alt,z+v.z*alt);let x0=latSin*equatorRadius,x1=latSin*(equatorRadius+1),y0=latCos*equatorRadius*flatteningFactor,y1=latCos*(equatorRadius+1)*flatteningFactor,dx=x1-x0,dy=y1-y0,l=Math.sqrt(dx*dx+dy*dy);this.additionalRotation.x.value=-Math.PI/2+Math.acos(dx/l);this.additionalRotation.y.value=Math.PI/2-lng;this.additionalRotation.z.value=0;super.update(deltaTime,forced)}}GeoPosition.type=new Type("geo-position",GeoPosition,Position.type);class Orientation extends Item{get relativeValues(){return this._relativeValues}get absoluteValues(){return this._absoluteValues}constructor(name,parent,data){super(name,parent,data);this._relativeValues=new Quaternion("relativeValues",this);this._absoluteValues=new Quaternion("absoluteValues",this);if(data!=undefined)this.deserialize(data)}}Orientation.type=new Type("orientation",Orientation,Item.type);class AxisAngleOrientation extends Orientation{get axis(){return this._axis}get angle(){return this._angle}constructor(name,parent,data){super(name,parent,data);this._axis=new Vector("axis",this,data);this._angle=new Angle("angle",this,data);if(data!=undefined)this.deserialize(data)}}AxisAngleOrientation.type=new Type("axis-angle-orientation",AxisAngleOrientation,Orientation.type);class LookAtOrientation extends Orientation{get targetName(){return this._targetName}get targetPosition(){return this._targetPosition}constructor(name,parent,data){super(name,parent,data);this._targetName=new String("target",this);this._targetPosition=new Vector("position",this);if(data!=undefined)this.deserialize(data)}}LookAtOrientation.type=new Type("look-at-orientation",LookAtOrientation,Orientation.type);class MatrixOrientation extends Orientation{get values(){return this._values}constructor(name,parent,data){super(name,parent,data);this._values=new Number("values",this,data);if(data!=undefined)this.deserialize(data)}}MatrixOrientation.type=new Type("matrix-orientation",MatrixOrientation,Orientation.type);class QuaternionOrientation extends Orientation{get x(){return this._x}get y(){return this._y}get z(){return this._z}get w(){return this._w}constructor(name,parent,data){super(name,parent,data);this._x=new Number("x",this);this._y=new Number("y",this);this._z=new Number("z",this);this._w=new Number("w",this,{value:1,defaultValue:1});if(data!=undefined)this.deserialize(data)}}QuaternionOrientation.type=new Type("quaternion-orientation",QuaternionOrientation,Orientation.type);class YawPitchRollOrientation extends Orientation{get yaw(){return this._yaw}get pitch(){return this._pitch}get roll(){return this._roll}constructor(name,parent,data){super(name,parent,data);this._yaw=new Angle("yaw",this);this._pitch=new Angle("pitch",this);this._roll=new Angle("roll",this);if(data!=undefined)this.deserialize(data)}}YawPitchRollOrientation.type=new Type("yaw-pitch-roll-orientation",YawPitchRollOrientation,Orientation.type);class Extension extends Item{constructor(name,parent,data){super(name,parent,data);if(data!=undefined)this.deserialize(data)}}Extension.type=new Type("extension",Extension,Item.type);class Pose extends Item{get frame(){return this._frame}get position(){return this._position}get orientation(){return this._orientation}get parent(){return this._parentPose}get childPoses(){return this._childPoses}get extensions(){return this._extensions}get relativePosition(){return this._relativePosition}get absolutePosition(){return this._absolutePosition}get relativeOrientation(){return this._relativeOrientation}get verticalVector(){return this._verticalVector}get forwardVector(){return this._forwardVector}constructor(name,parent,data){super(name,parent,data);this._position=new Position("position",this);this._orientation=new Orientation("orientation",this);this._childPoses=new Collection([Pose.type],this);this._extensions=new Collection([Extension.type],this);this._relativePosition=new Vector("relativePosition",this);this._absolutePosition=new Vector("absolutePosition",this);this._relativeOrientation=new Vector("relativeOrientation",this);this._verticalVector=new Vector("verticalVector",this);this._forwardVector=new Vector("forwardVector",this);this._verticalVector=new Vector("verticalVector",this);if(data!=undefined)this.deserialize(data)}}Pose.type=new Type("pose",Pose,Item.type);class GeoPose extends Pose{get frame(){return this._frame}get position(){return this._position}constructor(name,parent,data={}){super(name,parent,data);this._frame=data.frame||new GeoFrame("frame",this);this._position=new GeoPosition("position",this);if(data.frame)data.frame.links.add(this);if(data!=undefined)this.deserialize(data)}update(deltaTime=0,forced=false){if(this._updated&&!forced)return;super.update(deltaTime,forced)}}GeoPose.type=new Type("geopose",GeoPose,Pose.type);class EuclideanPoseQuaternion extends Pose{get position(){return this._position}get orientation(){return this._orientation}constructor(name,parent,data){super(name,parent,data);this._position=new EuclideanPosition("position",this,null);this._orientation=new QuaternionOrientation("orientation",this);if(data!=undefined)this.deserialize(data)}}EuclideanPoseQuaternion.type=new Type("euclidean-pose-quaternion",EuclideanPoseQuaternion,Pose.type);class EuclideanPoseYPR extends Pose{get position(){return this._position}get orientation(){return this._orientation}constructor(name,parent,data){super(name,parent,data);this._position=new EuclideanPosition("position",this,null);this._orientation=new YawPitchRollOrientation("orientation",this);if(data!=undefined)this.deserialize(data)}}EuclideanPoseYPR.type=new Type("euclidean-basic-ypr",EuclideanPoseYPR,Pose.type);class GeoPoseBasicQuaternion extends GeoPose{get orientation(){return this._orientation}constructor(name,parent,data){super(name,parent,data);this._orientation=new QuaternionOrientation("orientation",this);if(data!=undefined)this.deserialize(data)}}GeoPoseBasicQuaternion.type=new Type("geopose-basic-quaternion",GeoPoseBasicQuaternion,GeoPose.type);class GeoPoseBasicYPR extends GeoPose{get orientation(){return this._orientation}constructor(name,parent,data){super(name,parent,data);this._orientation=new YawPitchRollOrientation("orientation",this);if(data!=undefined)this.deserialize(data)}update(deltaTime=0,forced=false){if(this._updated&&!forced)return;super.update(deltaTime,forced)}}GeoPoseBasicYPR.type=new Type("geopose-basic-ypr",GeoPoseBasicYPR,GeoPose.type);class Entity extends Item{get representation(){return this._representation}get pose(){return this._pose}set pose(p){if(this._pose)this._pose.destroy();this._pose=p;this.updated=false}constructor(name,parent,representation){super(name,parent);this._pose=new Pose("pose",this);if(representation)this._representation=representation;else this._representation=new THREE.Object3D;this._representation.name=this.name;if(parent&&parent.representation){let parentEntity=parent;parentEntity._representation.add(this._representation);console.log("Parenting: "+this.name+" to "+parentEntity.name)}}update(deltaTime=0,forced=false){if(this.updated&&!forced)return;if(!this._pose.updated&&this._pose.position){this._pose.update();let p=this._pose.position.relativeValues;this._representation.position.set(p.x.value,p.y.value,p.z.value);let v=this._pose.position.additionalRotation;let vertical=new THREE.Vector3(v.x.value,v.y.value,v.z.value);this._representation.rotation.setFromVector3(vertical,"ZYX");let DegreesToRads=Math.PI/180;let o=this._pose.orientation;if(o.yaw!=undefined)this.representation.rotateZ(o.yaw.value*DegreesToRads);if(o.pitch!=undefined)this.representation.rotateY(o.pitch.value*DegreesToRads);if(o.roll!=undefined)this.representation.rotateX(o.roll.value*DegreesToRads)}super.update(deltaTime,forced)}}Entity.type=new Type("entity",Entity,Item.type);class ArrowEntity extends Entity{constructor(name,parent){super(name,parent);let radius=1e5,length=5e5;let material=new THREE.MeshLambertMaterial({color:16776960});let center=new THREE.Mesh(new THREE.SphereGeometry(radius,16,16),material);let body=new THREE.Mesh(new THREE.CylinderGeometry(radius/2,radius/2,length),material);let point=new THREE.Mesh(new THREE.ConeGeometry(radius,radius*2,16,16),material);body.position.x=length/2;body.rotateZ(-Math.PI/2);point.position.x=length;point.rotateZ(-Math.PI/2);this._representation.renderOrder=1e3;this._representation.add(center,body,point)}}ArrowEntity.type=new Type("arrow-entity",ArrowEntity,Entity.type);class AtmosphereEntity extends Entity{get ellipsoid(){return this._ellipsoid}get clouds(){return this._clouds}constructor(name,parent,data={}){super(name,parent);this._ellipsoid=new Ellipsoid("shape",this,data);this._clouds=new String("clouds",this);if(data)this.deserialize(data);this._mesh=new THREE.Mesh(new THREE.SphereGeometry(1,64,64),new THREE.MeshPhongMaterial({color:16777215,transparent:true}));this._representation.add(this._mesh)}update(deltaTime=0,forced=false){if(!this._ellipsoid.updated){this._mesh.scale.set(this._ellipsoid.radiusX.value*1.001,this._ellipsoid.radiusY.value*1.001,this._ellipsoid.radiusZ.value*1.001)}if(!this._clouds.updated&&this._clouds.value){const texture=(new THREE.TextureLoader).load(this._clouds.value);this._mesh.material.alphaMap=texture}super.update(deltaTime,forced)}}AtmosphereEntity.type=new Type("atmosphere-entity",AtmosphereEntity,Entity.type);class BackgroundEntity extends Entity{get shape(){return this._shape}get texture(){return this._texture}constructor(name,parent,data={}){super(name,parent);this._shape=new Ellipsoid("shape",this,data);this._texture=new String("texture",this);if(data)this.deserialize(data);this._mesh=new THREE.Mesh(new THREE.SphereGeometry(1,64,64),new THREE.MeshStandardMaterial({color:16777215,side:THREE.BackSide}));this._representation.add(this._mesh);this._mesh.renderOrder=-100}update(deltaTime=0,forced=false){if(!this._shape.updated){this._mesh.scale.set(this._shape.radiusX.value,this._shape.radiusY.value,this._shape.radiusZ.value)}if(!this._texture.updated){let textureURL=this._texture.value;if(textureURL){const texture=(new THREE.TextureLoader).load(textureURL);this._mesh.material=new THREE.MeshMatcapMaterial({map:texture,matcap:texture,side:THREE.BackSide})}}super.update(deltaTime,forced)}}BackgroundEntity.type=new Type("background-entity",BackgroundEntity,Entity.type);class GraticuleEntity extends Entity{get ellipsoid(){return this._ellipsoid}constructor(name,parent,data={}){super(name,parent);this._ellipsoid=new Ellipsoid("shape",this,data);if(data)this.deserialize(data);this._lines=new THREE.LineSegments(new THREE.EdgesGeometry(new THREE.SphereGeometry(1,36,18),.001),new THREE.LineBasicMaterial({color:16777215}));let DEG2RAD=Math.PI/180,width=.001;let red=new THREE.MeshBasicMaterial({color:8912896});let green=new THREE.MeshBasicMaterial({color:34816});let white=new THREE.MeshBasicMaterial({color:16777215});let detail=2;let torus=new THREE.TorusGeometry(1,width,8*detail,36*detail);let equator=new THREE.Mesh(torus,red);equator.rotateX(Math.PI/2);this._representation.add(equator);let greenwich=new THREE.Mesh(torus,green);this._representation.add(greenwich);for(let lat=10;lat<90;lat+=10){let a=lat*DEG2RAD,sin=Math.sin(a),cos=Math.cos(a);let meridian=new THREE.TorusGeometry(cos,width,8*detail,36*detail);let meridianP=new THREE.Mesh(meridian,white),meridianN=new THREE.Mesh(meridian,white);meridianP.rotateX(Math.PI/2);meridianN.rotateX(Math.PI/2);meridianP.position.y=sin;meridianN.position.y=-sin;this._representation.add(meridianP,meridianN)}for(let lng=10;lng<180;lng+=10){let parallel=new THREE.Mesh(torus,white);parallel.rotateY(lng*DEG2RAD);this._representation.add(parallel)}}update(deltaTime=0,forced=false){if(!this._ellipsoid.updated){this._representation.scale.set(this._ellipsoid.radiusX.value*1.005,this._ellipsoid.radiusY.value*1.01,this._ellipsoid.radiusZ.value*1.01)}super.update(deltaTime,forced)}}GraticuleEntity.type=new Type("graticule-entity",GraticuleEntity,Entity.type);class GridEntity extends Entity{constructor(name,parent,radius=1){super(name,parent);let size=1e6,halfSize=size/2;let segments=16;let grid=new THREE.GridHelper(size);grid.rotateX(-Math.PI/2);this.representation.add(grid);if(parent){let geopose=parent.pose.position;if(geopose.tangentVector){let t=geopose.tangentVector.getValues();let p=geopose.relativeValues.getValues();let tangent=new THREE.ArrowHelper(new THREE.Vector3(t.x,t.y,t.z),new THREE.Vector3(p.x,p.y,p.z),1e5);this.representation.add(tangent)}}let red=new THREE.MeshPhongMaterial({color:16711680}),green=new THREE.MeshPhongMaterial({color:65280}),blue=new THREE.MeshPhongMaterial({color:255}),axis=new THREE.CylinderGeometry(size/50,size/50,size,segments),arrow=new THREE.ConeGeometry(size/20,size/10,segments),ball=new THREE.SphereGeometry(size/20,segments,segments),xAxis=new THREE.Mesh(axis,red),xBall=new THREE.Mesh(ball,red),xArrow=new THREE.Mesh(arrow,red),yAxis=new THREE.Mesh(axis,green),yBall=new THREE.Mesh(ball,green),yArrow=new THREE.Mesh(arrow,green),zAxis=new THREE.Mesh(axis,blue),zBall=new THREE.Mesh(ball,blue),zArrow=new THREE.Mesh(arrow,blue);xAxis.rotateZ(-Math.PI/2);xArrow.rotateZ(-Math.PI/2);xArrow.position.x=halfSize;xBall.position.x=-halfSize;this.representation.add(xAxis,xBall,xArrow);yArrow.position.y=halfSize;yBall.position.y=-halfSize;this.representation.add(yAxis,yBall,yArrow);zAxis.rotateX(Math.PI/2);zArrow.rotateX(Math.PI/2);zArrow.position.z=halfSize;zBall.position.z=-halfSize;this.representation.add(zAxis,zBall,zArrow)}}GridEntity.type=new Type("grid-entity",GridEntity,Entity.type);class PresenceEntity extends Entity{get fieldOfView(){return this._fieldOfView}get aspectRatio(){return this._aspectRatio}get nearPlane(){return this._nearPlane}get farPlane(){return this._farPlane}constructor(name,parent,data={}){super(name,parent);this._fieldOfView=new Number("fov",this,{defaultValue:45});this._aspectRatio=new Number("aspect",this,{defaultValue:1});this._nearPlane=new Number("near",this,{defaultValue:.001});this._farPlane=new Number("far",this,{defaultValue:1e8});if(data!==undefined)this.deserialize(data);this._representation=new THREE.PerspectiveCamera(this._fieldOfView.value,this._aspectRatio.value,this._nearPlane.value,this._farPlane.value)}update(deltaTime=0,forced=false){if(this.updated&&!forced)return;let camera=this._representation;let updateMatrix=false;if(!this._fieldOfView.updated){camera.fov=this._fieldOfView.value;updateMatrix=true}if(!this._aspectRatio.updated){camera.aspect=this._aspectRatio.value;updateMatrix=true}if(!this._nearPlane.updated){camera.near=this._nearPlane.value;updateMatrix=true}if(!this._farPlane.updated){camera.far=this._farPlane.value;updateMatrix=true}if(updateMatrix)camera.updateProjectionMatrix();super.update(deltaTime,forced)}}PresenceEntity.type=new Type("presence-entity",PresenceEntity,Entity.type);class ShapeEntity extends Entity{constructor(name,parent,radius=1){super(name,parent);this.representation.add(new THREE.Mesh(new THREE.ConeGeometry(1e5,1e5,64,64),new THREE.MeshLambertMaterial({color:16776960})))}}ShapeEntity.type=new Type("shape-entity",ShapeEntity,Entity.type);class SpaceEntity extends Entity{constructor(name,parent,data={}){super(name,parent,new THREE.Scene);if(data)this.deserialize(data);this._representation.add(new THREE.AmbientLight(8947848,.5));this.light=new THREE.DirectionalLight(16777215);this.light.position.z=3e4;this._representation.add(this.light)}update(deltaTime=0,forced=false){super.update(deltaTime,forced)}}SpaceEntity.type=new Type("space-entity",SpaceEntity,Entity.type);class TerrainEntity extends Entity{get ellipsoid(){return this._ellipsoid}get diffuse(){return this._diffuse}get specular(){return this._specular}get normal(){return this._normal}get normalScale(){return this._normalScale}constructor(name,parent,data={}){super(name,parent);this._ellipsoid=new Ellipsoid("shape",this,data);this._diffuse=new String("diffuse",this);this._specular=new String("specular",this);this._normal=new String("normal",this);this._normalScale=new Number("normalScale",this);if(data)this.deserialize(data);this._mesh=new THREE.Mesh(new THREE.SphereGeometry(1,64,64),new THREE.MeshPhongMaterial({color:16777215}));this._representation.add(this._mesh)}update(deltaTime=0,forced=false){if(!this._ellipsoid.updated){this._mesh.scale.set(this._ellipsoid.radiusX.value,this._ellipsoid.radiusY.value,this._ellipsoid.radiusZ.value)}let material=this._mesh.material;if(!this._diffuse.updated&&this._diffuse.value){const texture=(new THREE.TextureLoader).load(this._diffuse.value);material.map=texture}if(!this._normal.updated&&this._normal.value){const texture=(new THREE.TextureLoader).load(this._normal.value);material.normalMap=texture}if(!this._specular.updated&&this._specular.value){const texture=(new THREE.TextureLoader).load(this._specular.value);material.specularMap=texture}if(!this._normalScale.updated){material.normalScale=new THREE.Vector2(this._normalScale.value,this._normalScale.value)}super.update(deltaTime,forced)}}TerrainEntity.type=new Type("terrain-entity",TerrainEntity,Entity.type);class User extends Item{get presences(){return this._presences}get views(){return this._views}constructor(name,parent,data={}){super(name,parent,data);this._presences=new Collection([Presence.type],this);this._views=new Collection([View.type],this);if(data!==undefined)this.deserialize(data);if(this._presences.count==0){let spaces=this.parent.spaces;for(let space of spaces){let presence=new Presence("DefaultPresence",this);presence.space=space;this.presences.add(presence)}}if(this._views.count==0)this._views.add(new View("DefaultView",this))}}User.type=new Type("user",User,Item.type);class View extends Item{get element(){return this._element}get canvas(){return this._canvas}get state(){return this._state}get width(){return this._width}get height(){return this._height}get layers(){return this._layers}get fpsValue(){return this._fpsValue}get fpsValues(){return this._fpsValues}constructor(name,parent,data={}){super(name,parent,data);this._deltaTime=0;this._lastTime=0;this._fpsCounter=0;this._fpsTimer=0;this._fpsValue=0;this._fpsValues=[];this._fpsValuesMaxSize=100;this._width=new Number("width",this,{defaultValue:100,min:0});this._height=new Number("height",this,{defaultValue:100,min:0});this._state=new String("state",this,{defaultValue:"Maximized",validValues:"Normal, Maximized, FullScreen, VR, AR"});this._layers=new Collection([Layer.type],this);this._element=View.createDomElement("div",this.name+"View",undefined,"CoEditAR-View");this._canvas=View.createDomElement("canvas",this.name+"Canvas",this._element,"CoEditAR-Canvas","width:100%; height:100%;");this._viewport=new ViewPort(this._canvas,this.update.bind(this));if(data!=undefined)this.deserialize(data);if(this._layers.count==0){let presences=this.parent.presences;for(let presence of presences){this.layers.add(new Layer("Layer",this,presence))}}this.resize();window.onresize=e=>{this.resize()};this._state.onModified.add((()=>{this.resize()}))}update(time=0){time/=1e3;this._deltaTime=time-this._lastTime;this._lastTime=time;this._fpsTimer+=this._deltaTime;this._fpsCounter++;if(this._fpsTimer>=1){this._fpsValue=this._fpsCounter;if(this._fpsValues.length>=this._fpsValuesMaxSize)this._fpsValues.shift();this._fpsValues.push(this._fpsValue);this._fpsTimer%=1;this._fpsCounter=0;console.log("FPS: "+this._fpsValue)}for(let layer of this._layers){layer.update(this._deltaTime);let camera=layer.presence.entity.representation;layer.space.entity.light.position.copy(camera.position);layer.space.entity.light.rotation.copy(camera.rotation);this._viewport.render(layer.presence)}}resize(){if(this._state.updated&&this._state.value=="FullScreen")if(!document.fullscreenElement)this._state.value="Maximized";if(!this._state.updated){switch(this._state.value){case"Normal":this._element.style.position="initial";break;case"Maximized":this._element.style.position="fixed";this._element.style.top="0";this._element.style.left="0";this._element.style.width="100vw";this._element.style.height="100vh";break;case"FullScreen":if(!document.fullscreenElement)this._element.requestFullscreen();this._element.style.width="100vw";this._element.style.height="100vh";break}this._state.updated=true}this._width.value=this._element.clientWidth;this._height.value=this._element.clientHeight;this._viewport.resize(this._width.value,this._height.value);let aspectRatio=this._width.value/this._height.value;for(let layer of this._layers){layer.presence.entity.aspectRatio.value=aspectRatio;layer.presence.entity.update()}}static createDomElement(type,id,parent,classes,style,content){let element=document.createElement(type);if(id)element.id=id;if(classes)element.className=classes;if(style)element.style.cssText=style;if(content)element.innerHTML=content;(parent?parent:document.body).appendChild(element);return element}static addCssRule(selector,rule,override=false){if(document.styleSheets.length==0)document.head.append(document.createElement("style"));let stylesheet=document.styleSheets[0];let rules=stylesheet.cssRules,ruleIndex,ruleCount=rules.length;for(ruleIndex=0;ruleIndex<ruleCount;ruleIndex++){if(rules[ruleIndex].cssText.startsWith(selector)){if(override)rules[ruleIndex].cssText=selector+" "+rule;else return}}stylesheet.insertRule(selector+" "+rule,ruleCount)}}View.type=new Type("view",View,Item.type);class ViewPort{get canvas(){return this._canvas}get renderer(){return this._renderer}get width(){return this._width}get height(){return this._height}constructor(canvas,updateFunction){this._canvas=canvas;this._renderer=new THREE.WebGLRenderer({canvas:this._canvas,antialias:true,logarithmicDepthBuffer:true});this._renderer.setPixelRatio(window.devicePixelRatio);this._renderer.xr.enabled=true;this._renderer.setAnimationLoop(updateFunction)}resize(width,height){this._width=width;this._height=height;this._renderer.setSize(width,height)}render(presence){this._renderer.setClearColor(16777215);this._renderer.clear();this._renderer.render(presence.space.entity.representation,presence.entity.representation)}}class Layer extends Item{get widgets(){return this._widgets}get space(){return this._space}get presence(){return this._presence}get entity(){return this._space.entity}constructor(name,parent,presence){super(name,parent);this._widgets=new Collection([Widget.type],this);this._presence=presence;this._space=presence.space;this._presence.links.add(this);this._space.links.add(this)}update(deltaTime=0,forced=false){if(this._updated&&!forced)return;this.space.update(deltaTime,forced);this.presence.update(deltaTime,forced);for(let widget of this.widgets)widget.update(deltaTime,forced);super.update(deltaTime,forced)}}Layer.type=new Type("layer",Layer,Item.type);class Space extends Item{get entity(){return this._entity}get subspaces(){return this._subspaces}get presences(){return this._presences}get widgets(){return this._widgets}constructor(name,parent,data={}){super(name,parent,data);this._entity=new SpaceEntity(this.name);this._subspaces=new Collection([Space.type],this);this._presences=new Collection([Presence.type],this);this._widgets=new Collection([Widget.type],this);if(data!=undefined)this.deserialize(data)}update(deltaTime=0,forced=false){if(this._updated&&!forced)return;super.update(deltaTime,forced)}}Space.type=new Type("space",Space,Item.type);class Presence extends Item{get entity(){return this._entity}get space(){return this._space}set space(space){this._space=space}constructor(name,parent,data={}){super(name,parent,data);this._entity=new PresenceEntity(name+"Entity",this);if(data)this.deserialize(data)}}Presence.type=new Type("presence",Presence,Item.type);class Widget extends Item{get entity(){return this._entity}get widgets(){return this._widgets}constructor(name,parent,data={}){super(name,parent,data);this._widgets=new Collection([Widget.type],this);if(!parent||!(parent.type.is(Layer.type)||parent.type.is(Widget.type)))throw Error("Invalid parent for Widget "+name);this._parentEntity=parent.entity;this._entity=new Entity(this.name,this._parentEntity);this._entity.links.add(this);if(data!=undefined)this.deserialize(data)}update(deltaTime=0,forced=false){if(this._updated&&!forced)return;super.update(deltaTime,forced);this._entity.update(deltaTime,forced)}}Widget.type=new Type("widget",Widget,Item.type);class BackgroundWidget extends Widget{constructor(name,parent,data={}){super(name,parent,data);if(data.radius){data.radiusX=data.radius;data.radiusY=data.radius;data.radiusZ=data.radius}let mesh=new BackgroundEntity(name+"Mesh",this._entity,data);if(data!=undefined)this.deserialize(data)}}BackgroundWidget.type=new Type("background-widget",BackgroundWidget,Widget.type);class CameraWidget extends Widget{get pose(){return this._entity.pose}constructor(name,parent,data={}){super(name,parent,data);if(!parent||!parent.type.is(Layer.type))throw Error("Invalid parent");this._entity=parent.presence.entity;this._entity.pose=new GeoPoseBasicYPR("pose",this._entity,data);if(data!=undefined)this._entity.pose.deserialize(data)}}CameraWidget.type=new Type("Camera-widget",CameraWidget,Widget.type);class GeoPoseWidget extends Widget{get arrow(){return this._arrow}get grid(){return this._arrow}get frame(){return this._frame}constructor(name,parent,data={}){super(name,parent,data);if(data.frame){this._frame=data.frame;this._frame.links.add(this)}this._entity.pose=new GeoPoseBasicYPR("pose",this._entity,data);this._grid=new GridEntity(this._name+"Grid",this._entity);this._arrow=new ArrowEntity(this._name+"Arrow",this._grid);this._arrow.pose=new EuclideanPoseYPR("pose",this._arrow,data);if(data!=undefined)this.deserialize(data);this.update(0,true)}update(deltaTime=0,forced=false){if(this.updated&&!forced)return;if(!this._frame.updated){this._frame.update()}console.log("Updated: "+this.name);super.update(deltaTime,forced)}}GeoPoseWidget.type=new Type("GeoPose-widget",GeoPoseWidget,Widget.type);class PlanetWidget extends Widget{get terrain(){return this._terrain}get atmosphere(){return this._atmosphere}get graticule(){return this._graticule}get frame(){return this._frame}constructor(name,parent,data={}){super(name,parent,data);this._frame=data.frame;data.radiusX=this._frame.equatorialRadius.value;data.radiusY=this._frame.polarRadius.value;data.radiusZ=this._frame.equatorialRadius.value;this.frame.links.add(this);this._terrain=new TerrainEntity(name+"Terrain",this._entity,data);if(data.atmosphere)this._atmosphere=new AtmosphereEntity(name+"Atmosphere",this._entity,data);if(data.graticule)this._graticule=new GraticuleEntity(name+"Graticule",this._entity,data);if(data!=undefined)this.deserialize(data)}update(deltaTime=0,forced=false){if(this.updated&&!forced)return;if(!this._frame.updated){this._frame.update();let radiusX=this._frame.equatorialRadius.value,radiusY=this._frame.polarRadius.value,radiusZ=this._frame.equatorialRadius.value;this._terrain.ellipsoid.radiusX.value=radiusX;this._terrain.ellipsoid.radiusY.value=radiusY;this._terrain.ellipsoid.radiusZ.value=radiusZ;if(this._atmosphere){this._atmosphere.ellipsoid.radiusX.value=radiusX;this._atmosphere.ellipsoid.radiusY.value=radiusY;this._atmosphere.ellipsoid.radiusZ.value=radiusZ}if(this._graticule){this._graticule.ellipsoid.radiusX.value=radiusX;this._graticule.ellipsoid.radiusY.value=radiusY;this._graticule.ellipsoid.radiusZ.value=radiusZ}}super.update(deltaTime,forced)}}PlanetWidget.type=new Type("planet-widget",PlanetWidget,Widget.type);class GeoPoseSandbox extends Item{static get frameworkName(){return"GeoPose Sandbox"}static get frameworkVersion(){return"0.1"}static get instances(){return GeoPoseSandbox._instances}static get autoInit(){return GeoPoseSandbox._autoInit}static set autoInit(value){GeoPoseSandbox._autoInit=value}get spaces(){return this._spaces}get users(){return this._users}constructor(data){super("root");this._spaces=new Collection([Space.type],this);this._users=new Collection([User.type],this);if(data!=undefined)this.deserialize(data);GeoPoseSandbox._instances.push(this);if(this._spaces.count==0)this._spaces.add(new Space("DefaultSpace",this));if(this._users.count==0)this._users.add(new User("DefaultUser",this));console.log(GeoPoseSandbox.frameworkName+" "+GeoPoseSandbox.frameworkVersion+" Initialized")}static init(params={}){return new GeoPoseSandbox(params)}}GeoPoseSandbox.type=new Type("root",GeoPoseSandbox,Item.type);GeoPoseSandbox._instances=[];GeoPoseSandbox._autoInit=true;